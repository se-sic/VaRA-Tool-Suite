dist: bionic
language: python
python:
  - "3.6"
  - "3.7"
  - "3.8"

addons:
  apt:
    packages:
      - time
      - git
      - libgit2-dev
      - ninja-build

install:
  - pip install .
  - pip install -r requirements.txt
  - pip install codecov
  - pip install pytest-cov
  - pip install coverage
  - pip install mypy

script:
  - pre-commit run --from-ref origin/vara-dev --to-ref HEAD
  - mkdir -p benchbuild
  - export BB_TMP_DIR=benchbuild/tmp
  - pytest --cov=./ varats tests
  - unset BB_TMP_DIR
  - rm -r benchbuild
  - ./run_extra_tests.sh
  - coverage combine -a
  - coverage report
  - mypy --strict varats

after_success:
  - codecov

branches:
  only:
    - vara
    - vara-dev
